# これは何か.

たいたい竹流氏作成のWebアプリケーション「どどんとふ」のサーバサイドスクリプトを使用し、ソースリファクタリングのワークスタディを行います。
書籍「リーダブルコード」を使用した個人演習のようなものです。

# 前提条件

* リファクタリング対象はサーバサイドのRubyソースコードのみ
* ソースの動作対象はv1.9とし、1.8以前との後方互換は(あまり)考えない
* コーディングルールはJetBrains製のRuby用IDE RubyMineのスタイルを標準とする

# 雑感 改修方針

* 命名がやや冗長な傾向がある.(感覚的に少し長すぎるものが多い.かつ、独自用語と化してしまっているものがあるためかえって前提知識無しでは内容がわかりづらくなっているように感じる)
* get,setなどのprefixは不要では？(RubyのデファクトプラクティスとしてDackTypingを推奨しているため、メソッドと変数を命名でキッチリと区別する必要は薄いと思われる)
* 幾つかのラッパメソッドは不要(特にFileクラスなどの標準メソッドに委譲するだけの定義は現在の歴史を見るに早計な拡張性とおもわれるので一旦廃棄しても良いのでは)
* Serverクラスの役割が設計面から見て大きすぎる(大きくデータストアアクセス系,route処理系,各種command系に分類できる.Rubyは大クラス主義だが、単一クラスにしてはあまりに役割が多い)
* 一時変数が多い(特にHashについては一時変数の使用回数的に直接参照した方が望ましい)
* ロギング処理は全面的に改修したい(個々の出力毎にLevelを設定したい,出力内容を負荷分析など運用・保守に役立つデータになるように整えたい)

# 最終目標
* Rack互換アプリケーションとして改修(SinatraないしはGrapeをコアフレームワークに採用することも検討に含める)

# 履歴
* 2013/02/22 saveDirInfo周りの改修に着手
    * saveDataディレクトリ配下のアクセス処理は全てここに集約する事を検討
    * クラスメソッドでsaveData全体的な処理,インスタンスメソッドでdata_X系の部屋ディレクトリ1つ分の処理に切り分ける
    * ディレクトリ・ファイルアクセスが生の状態になっているので隠蔽化するように修正した方が良さそう(ファイルベースストア以外の方式にも対応できるのが望ましい)
* 2013/02/20 トップダウン方式に個々のメソッド内部をリファクタリング
    * 式の簡略化
    * 不要なラッパメソッド(単純に別のメソッドを呼び出してreturnしているだけのメソッド等)や参照先の少ないメソッドの削除・包含
* 2013/02/17 下処理完了
* 2013/01/19 下処理:名称の暫定変更
    * 変数・メソッド名でキャメルケース記法で命名されているものをRuby標準スタイルのスネークケース記法で改名
    * 機械的な置き換えが適さない一部の名称は随時付け直す(ex. 機械的にスネークケースに置き換えると長すぎるor既に同一スコープに同じ名前が定義されている)
* 2013/01/18 下処理:デファクトスタンダードなRubyStyleでない部分の修正
    * 後置文以外のif,unlessの条件式から()を省略
    * 行末の;を省略
    * メソッド末尾のreturnを省略
    * 上記の結果、冗長になってしまう一時変数は削除(ex.直前の行で同じ値を返している場合)
    * 処理が無い場合でもcase文の末尾にelse式を明記
    * ネストしている条件式で && || で1つの条件式となる場合はそのように改修
* 2013/01/18 作業開始